# 北工大安卓开发

## Android Software Stack

安卓系统从上到下分为四层：
1. Applications (应用层)

    就是手机上装的各种 APP。

2. Application Framework (应用框架层)

    提供了我们开发 APP 时需要调用的各种系统服务的 API，比如 Activity Manager, Window Manager, Content Providers 等。

3. Libraries and Android Runtime (库和安卓运行时)

    包含一系列用 C/C++ 写的库，来处理图形、媒体、数据库等高性能任务。这就是 Java/Kotlin 代码能跑起来的地方（在早期是 Dalvik 虚拟机，现在主要是 ART）。

    ::: info
    ART (Android Runtime) 是 Dalvik 的继任者，使用预编译技术 (Ahead-of-Time, AOT) ，它在应用安装时就把应用完全编译成本地机器码，换来了更高的性能但需要更多的存储空间。
    :::

4. Linux Kernel (Linux 内核)

    安卓是基于 Linux 内核的。

## 设计前提

由于移动设备资源非常有限，安卓开发非常关注性能和内存管理。

这个资源有限的考量，是后续所有复杂知识点（比如 Service、BroadcastReceiver、Activity生命周期）的都有在关注的根本。


## 四大组件 (Building Blocks)


1. Activities (活动)


    这是构成用户界面的基础。
    
    可以视作应用里的“一个屏幕”或“一个窗口” 。用户能看到和交互的一切，都发生在 Activity 里。

2. Services (服务)

     这是一个在后台运行的组件。

     当你用别的 APP 时，音乐播放器在后台依然能工作，这就是 Service 在发挥   作用。

3. Content Providers (内容提供者)

    它为多个应用提供了一个抽象的数据访问层。

    Content Provider 用来安全地在应用之间共享数据的机制（比如让别的 app 访问日历）。

4. Intents (意图)

    Intent 是系统消息，在设备内部运行，用于向应用程序通知各类事件

    你想从一个屏幕（Activity A）跳转到另一个屏幕（Activity B），就需要发送一个 Intent 。你想打开相机拍照，也是发送一个 Intent。

## 项目文件结构

安卓开发的项目结构规范中有3个重要文件：

1.  `AndroidManifest.xml` (清单文件)

    该清单文件是整个应用的地基，功能包括但不限于：
    - 列出了应用所有的 Activity 和 Service 。
    - 声明应用需要的权限（permission），比如访问网络、读取联系人 。
    - 声明应用的图标 (`android:icon`) 和名称 (`android:label`) 。
    - 指定启动 Activity ：通过 `<intent-filter>` 告诉系统，哪个 Activity 是点APP 图标时第一个打开的。

2. `java/` 或 `src/` 目录

    存放所有的 `.java` 或 `.kotlin` 源代码文件。

3. `res/` 目录

    存放所有非代码的静态资源。

    | 子目录       | 说明                             |
    |--------------|----------------------------------|
    | `drawable/`  | 存放图片资源                     |
    | `layout/`    | 存放界面布局文件（XML 格式）     |
    | `values/`    | 存放字符串（`strings.xml`）、颜色（`colors.xml`）、样式（`styles.xml`），尺寸值（`dimens.xml`）等资源文件 |

    Android Studio 会自动生成一个 `R.java` 文件，里面包含了所有资源的 ID，方便在代码中引用。 ex: `R.layout.activity_main` -> `res/layout/activity_main.xml` 。    

## 连接代码与布局 (XML) 

1. 布局文件 (`activity_main.xml`) - 位于 `/res/layout/`

    用来定义界面的外观和结构。

    - 它使用各种标签（View），比如 `<TextView>` (显示文本) 和 `<RelativeLayout>` (一种布局方式) 。

    -  和所有控件一样，它有两个非常重要的属性：`android:layout_width` 和 `android:layout_height`。

        - 值 `match_parent`：表示和父容器一样大。

        - 值 `wrap_content`：表示刚刚好能包住里面的内容。

2. Activity 代码 (`MainActivity.java` 或 `MainActivity.kt`)

    这是项目的入口，负责加载布局文件并处理用户交互，你应当把其用作 app 的 Controller。

    - 继承自 `AppCompatActivity`。

    - 在 Activity 创建时  `onCreate()`  方法自动被调用，其中最重要的一行是：

        ```java
        setContentView(R.layout.activity_main);  // 在 kotlin 中写法基本一致 
        ``` 

        这行代码会去加载 `R.java` 文件里 ID 为 `layout.activity_main` 的那个资源（即 `res/layout/activity_main.xml`），并把它作为这个 Activity 的界面显示出来。

#### 布局文件速览

这是用来绘制界面的 XML 布局文件，由嵌套的元素组成。

::: details 示例

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/main"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Hello World!"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>
```

:::

常用元素：

- `<RelativeLayout> ` (根元素)： 这是一个布局容器，它内部的元素可以相对于父容器或其它元素来定位。

- `<TextView>` (子元素)： 这是一个用来显示文本的控件（也叫 View ）。

除了 `android:layout_width` 和 `android:layout_height`，`TextView` 还有一个重要属性—— `android:text`，用来设置显示的文本内容。

