# Unity-导航寻路系统

在游戏中，你经常会看到敌人、NPC 或同伴角色能够智能地绕过障碍物，从 A 点移动到 B 点。它们不是简单地直线行走，而是能找到一条可通行的路径。实现这种行为的核心技术就是导航寻路系统。

Unity 的导航系统主要基于一个叫做导航网格（Navigation Mesh, 简称 NavMesh）的概念。

官方文档：[AI Navigation](https://docs.unity3d.com/Packages/com.unity.ai.navigation@2.0/manual/index.html)

## 内部工作原理

Unity 的导航系统（Navigation System）主要负责在游戏场景中让角色（Agent）智能地从起点移动到终点。它分为两个部分：全局导航负责根据整个场景的几何信息找到跨越地图的路径；局部导航则在移动过程中处理即时方向调整与避障。导航系统通过检测代理可站立的位置并将其连接成覆盖场景表面的导航网格（NavMesh），网格由凸多边形组成，并记录多边形间的邻接关系，方便全局路径搜索。

寻路时，系统首先将起点和终点映射到最近的多边形上，然后使用 A\* 算法在多边形邻接图中查找路径。找到的多边形序列称为走廊（Corridor），代理会不断朝下一个可见拐角前进。若场景中有多个代理同时移动，它们会因避让而偏离原路径，此时系统会根据多边形连通性动态修正走廊。局部避障部分使用 RVO（Reciprocal Velocity Obstacles） 技术预测潜在碰撞并调整速度与方向，确保流畅移动。

障碍物分为两种处理方式：动态障碍（如移动物体）适合使用局部避障即时绕行；静态障碍（长期阻挡路径）则需要修改 NavMesh（称为 Carving），在网格上挖空不可通行的区域，这一过程计算代价较高。此外，Unity 还提供 NavMesh Link 组件，用于标记非可行走表面的特殊通道，如跳栅栏或穿门，代码可在运行时访问这些链接并触发对应的动作。

在生成 NavMesh 时，系统会使用体素化（Voxelization）将场景栅格化，提取可行走表面后生成导航网格。体素大小（Voxel Size）会影响精度与烘焙速度：体素越小，精度越高但生成越慢；体素越大，速度越快但精度降低。默认建议每个 Agent 半径对应 3 个体素（直径 6 个体素），适用于大多数情况；宽阔区域可用 1–2 个体素加快速度，狭窄室内则建议 4–6 个体素，而超过 8 个体素通常意义不大。