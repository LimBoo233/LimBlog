# AI Navigation æ–‡æ¡£ç¿»è¯‘


å®˜æ–¹æ–‡æ¡£ï¼š[AI Navigation](https://docs.unity3d.com/Packages/com.unity.ai.navigation@2.0/manual/index.html)

## Navigation System In Unity

### å†…éƒ¨å·¥ä½œåŸç†

Unity çš„**å¯¼èˆªç³»ç»Ÿ**ï¼ˆ`Navigation System`ï¼‰ä¸»è¦è´Ÿè´£åœ¨æ¸¸æˆåœºæ™¯ä¸­è®©è§’è‰²ï¼ˆ`Agent`ï¼‰æ™ºèƒ½åœ°ä»èµ·ç‚¹ç§»åŠ¨åˆ°ç»ˆç‚¹ã€‚å®ƒåˆ†ä¸ºä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š

* **å…¨å±€å¯¼èˆª**ï¼šè´Ÿè´£æ ¹æ®æ•´ä¸ªåœºæ™¯çš„å‡ ä½•ä¿¡æ¯æ‰¾åˆ°è·¨è¶Šåœ°å›¾çš„è·¯å¾„
* **å±€éƒ¨å¯¼èˆª**ï¼šåœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­å¤„ç†å³æ—¶æ–¹å‘è°ƒæ•´ä¸é¿éšœ

å¯¼èˆªç³»ç»Ÿé€šè¿‡æ£€æµ‹ä»£ç†å¯ç«™ç«‹çš„ä½ç½®å¹¶å°†å…¶è¿æ¥æˆè¦†ç›–åœºæ™¯è¡¨é¢çš„**å¯¼èˆªç½‘æ ¼**ï¼ˆ`NavMesh`ï¼‰ï¼Œç½‘æ ¼ç”±å‡¸å¤šè¾¹å½¢ç»„æˆï¼Œå¹¶è®°å½•å¤šè¾¹å½¢é—´çš„é‚»æ¥å…³ç³»ï¼Œæ–¹ä¾¿å…¨å±€è·¯å¾„æœç´¢ã€‚

```mermaid
graph TB
    subgraph Global ["ğŸŒ Global å…¨å±€å±‚çº§"]
        ML["åœ°å›¾ä½ç½®<br/>Map Locations"]
        FP["å¯»æ‰¾è·¯å¾„<br/>Find Path"]
        CO["èµ°å»Š<br/>Corridor"]
        
        %% NavMesh ä½œä¸ºæ ¸å¿ƒè¿æ¥ç‚¹
        NM["å¯¼èˆªç½‘æ ¼<br/>NavMesh"]
        ML --> FP --> CO
        NM --> ML
        NM --> FP
        NM --> CO
    end
    
    subgraph Local ["ğŸ¯ Local å±€éƒ¨å±‚çº§"]
        ST["è½¬å‘<br/>Steering"]
        OA["éšœç¢é¿è®©<br/>Obstacle Avoidance"]
        MV["ç§»åŠ¨<br/>Move"]
        UC["æ›´æ–°èµ°å»Š<br/>Update Corridor"]
        
        %% å±€éƒ¨å¾ªç¯
        UC --> ST
        ST --> OA --> MV --> UC
    end
    
    %% å…³é”®è¿æ¥ï¼šCorridor æŒ‡å‘ Steering
    CO --> ST
    
    classDef globalBox fill:#272822,stroke:#66d9ef,stroke-width:2px,color:#f8f8f2
    classDef localBox fill:#272822,stroke:#fd971f,stroke-width:2px,color:#f8f8f2
    classDef coreNode fill:#1e1f1c,stroke:#a6e22e,stroke-width:3px,color:#f8f8f2
    
    class ML,FP,CO globalBox
    class ST,OA,MV,UC localBox
    class NM coreNode
```

#### å¯»è·¯è¿‡ç¨‹

1. **è·¯å¾„è§„åˆ’**ï¼šç³»ç»Ÿé¦–å…ˆå°†èµ·ç‚¹å’Œç»ˆç‚¹æ˜ å°„åˆ°æœ€è¿‘çš„å¤šè¾¹å½¢ä¸Š
2. **ç®—æ³•æœç´¢**ï¼šä½¿ç”¨ `A*` ç®—æ³•åœ¨å¤šè¾¹å½¢é‚»æ¥å›¾ä¸­æŸ¥æ‰¾è·¯å¾„
3. **èµ°å»Šç”Ÿæˆ**ï¼šæ‰¾åˆ°çš„å¤šè¾¹å½¢åºåˆ—ç§°ä¸º**èµ°å»Š**ï¼ˆ`Corridor`ï¼‰ï¼Œä»£ç†ä¼šä¸æ–­æœä¸‹ä¸€ä¸ªå¯è§æ‹è§’å‰è¿›
4. **åŠ¨æ€ä¿®æ­£**ï¼šè‹¥åœºæ™¯ä¸­æœ‰å¤šä¸ªä»£ç†åŒæ—¶ç§»åŠ¨ï¼Œå®ƒä»¬ä¼šå› é¿è®©è€Œåç¦»åŸè·¯å¾„ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šæ ¹æ®å¤šè¾¹å½¢è¿é€šæ€§åŠ¨æ€ä¿®æ­£èµ°å»Š
5. **å±€éƒ¨é¿éšœ**ï¼šä½¿ç”¨ `RVO`ï¼ˆReciprocal Velocity Obstaclesï¼‰æŠ€æœ¯é¢„æµ‹æ½œåœ¨ç¢°æ’å¹¶è°ƒæ•´é€Ÿåº¦ä¸æ–¹å‘ï¼Œç¡®ä¿æµç•…ç§»åŠ¨

#### éšœç¢ç‰©å¤„ç†

éšœç¢ç‰©åˆ†ä¸ºä¸¤ç§å¤„ç†æ–¹å¼ï¼š

* **åŠ¨æ€éšœç¢**ï¼ˆå¦‚ç§»åŠ¨ç‰©ä½“ï¼‰ï¼šé€‚åˆä½¿ç”¨å±€éƒ¨é¿éšœå³æ—¶ç»•è¡Œ
* **é™æ€éšœç¢**ï¼ˆé•¿æœŸé˜»æŒ¡è·¯å¾„ï¼‰ï¼šéœ€è¦ä¿®æ”¹ `NavMesh`ï¼ˆç§°ä¸º `Carving`ï¼‰ï¼Œåœ¨ç½‘æ ¼ä¸ŠæŒ–ç©ºä¸å¯é€šè¡Œçš„åŒºåŸŸ
  * âš ï¸ è¿™ä¸€è¿‡ç¨‹è®¡ç®—ä»£ä»·è¾ƒé«˜

æ­¤å¤–ï¼ŒUnity è¿˜æä¾› `NavMesh Link` ç»„ä»¶ï¼Œç”¨äºæ ‡è®°éå¯è¡Œèµ°è¡¨é¢çš„ç‰¹æ®Šé€šé“ï¼Œå¦‚è·³æ …æ æˆ–ç©¿é—¨ï¼Œä»£ç å¯åœ¨è¿è¡Œæ—¶è®¿é—®è¿™äº›é“¾æ¥å¹¶è§¦å‘å¯¹åº”çš„åŠ¨ä½œã€‚


åœ¨ç”Ÿæˆ `NavMesh` æ—¶ï¼Œç³»ç»Ÿä¼šä½¿ç”¨**ä½“ç´ åŒ–**ï¼ˆ`Voxelization`ï¼‰å°†åœºæ™¯æ …æ ¼åŒ–ï¼Œæå–å¯è¡Œèµ°è¡¨é¢åç”Ÿæˆå¯¼èˆªç½‘æ ¼ã€‚

**ä½“ç´ å¤§å°**ï¼ˆ`Voxel Size`ï¼‰ä¼šå½±å“ç²¾åº¦ä¸çƒ˜ç„™é€Ÿåº¦ï¼š

| ä½“ç´ å¤§å° | ç²¾åº¦ | ç”Ÿæˆé€Ÿåº¦ | é€‚ç”¨åœºæ™¯ |
|----------|------|----------|----------|
| è¶Šå° | è¶Šé«˜ | è¶Šæ…¢ | éœ€è¦ç²¾ç¡®å¯¼èˆªçš„åŒºåŸŸ |
| è¶Šå¤§ | è¶Šä½ | è¶Šå¿« | å®½é˜”å¼€æ”¾åŒºåŸŸ |

**æ¨èé…ç½®ï¼š**

* **é»˜è®¤è®¾ç½®**ï¼šæ¯ä¸ª `Agent` åŠå¾„å¯¹åº” `3` ä¸ªä½“ç´ ï¼ˆç›´å¾„ `6` ä¸ªä½“ç´ ï¼‰ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µ
* **å®½é˜”åŒºåŸŸ**ï¼šå¯ç”¨ `1-2` ä¸ªä½“ç´ åŠ å¿«é€Ÿåº¦
* **ç‹­çª„å®¤å†…**ï¼šå»ºè®® `4-6` ä¸ªä½“ç´ 
* **æ€§èƒ½æç¤º**ï¼šè¶…è¿‡ `8` ä¸ªä½“ç´ é€šå¸¸æ„ä¹‰ä¸å¤§ï¼Œåè€Œæµªè´¹æ€§èƒ½

#### ä»£ç†å½¢çŠ¶ä¸å±æ€§

`NavMesh Agent` åœ¨åœºæ™¯ä¸­ä»¥ä¸€ä¸ª**ç›´ç«‹åœ†æŸ±ä½“**è¡¨ç°ï¼Œå…¶å‡ ä½•å±æ€§å¦‚ä¸‹ï¼š

* **åŠå¾„**ï¼šç”±ç»„ä»¶çš„ `Radius` å±æ€§æŒ‡å®š
* **é«˜åº¦**ï¼šç”±ç»„ä»¶çš„ `Height` å±æ€§æŒ‡å®š
* **å§¿æ€**ï¼šåœ†æŸ±ä½“ä¿æŒç›´ç«‹çŠ¶æ€ï¼Œç”¨äºæ£€æµ‹ä¸å“åº”éšœç¢ç‰©å’Œå…¶ä»–ä»£ç†çš„ç¢°æ’

> ğŸ’¡ **æç¤º**ï¼šå½“ `GameObject` çš„é”šç‚¹ä¸åœ¨åœ†æŸ±ä½“åŸºåº•æ—¶ï¼Œå¯é€šè¿‡ `Base Offset` å±æ€§è°ƒæ•´é«˜åº¦å·®ã€‚

#### å¤§å°è®¾ç½®

##### ğŸ”§ çƒ˜ç„™è®¾ç½®ï¼ˆNavigation çª—å£ï¼‰
- **ç”¨é€”**ï¼šæŒ‡å®šåœºæ™¯ä¸­æ‰€æœ‰ä»£ç†é¿è®©é™æ€å‡ ä½•ä½“æ—¶çš„**å…¨å±€å°ºå¯¸**
- **é™åˆ¶**ï¼šä¸ºäº†èŠ‚çœå†…å­˜å’Œ CPUï¼Œçƒ˜ç„™æ—¶åªèƒ½è®¾ç½®ä¸€ç§å°ºå¯¸

##### ğŸ® ä»£ç†ç»„ä»¶ï¼ˆNavMesh Agentï¼‰
- **ç”¨é€”**ï¼šå®šä¹‰æ¯ä¸ªä»£ç†ä¸ç§»åŠ¨éšœç¢ç‰©æˆ–å…¶ä»–ä»£ç†çš„**ç¢°æ’åŠå¾„å’Œé«˜åº¦**
- **çµæ´»æ€§**ï¼šå¯é’ˆå¯¹ä¸åŒè§’è‰²å•ç‹¬è°ƒæ•´
- **ç¤ºä¾‹**ï¼šç»™æ²‰é‡å£«å…µæ›´å¤§åŠå¾„ä»¥ä¿æŒæ›´å¤§é—´è·

#### å…¸å‹ç”¨æ³•ä¸å˜ä½“

| é…ç½®æ–¹å¼ | æè¿° | é€‚ç”¨åœºæ™¯ |
|----------|------|----------|
| **æ ‡å‡†é…ç½®** | çƒ˜ç„™è®¾ç½®å’Œç»„ä»¶å±æ€§ä½¿ç”¨ç›¸åŒå°ºå¯¸ | ç¡®ä¿ç¯å¢ƒé¿è®©ä¸€è‡´æ€§ |
| **ç‰¹æ®Šé…ç½®** | ç»„ä»¶å±æ€§ä¸­å¢å¤§åŠå¾„ | è®©å…¶ä»–å•ä½ä¸»åŠ¨ç•™å‡ºç©ºé—´ï¼ŒåŒæ—¶ä»éµå¾ªç›¸åŒçš„å¯¼èˆªç½‘æ ¼è¡Œèµ°è§„åˆ™ |

**æ ¸å¿ƒç†å¿µ**ï¼šé€šè¿‡è°ƒæ•´ä»£ç†åŠå¾„ï¼Œå¯ä»¥åœ¨ä¸æ”¹å˜å¯¼èˆªç½‘æ ¼çš„å‰æä¸‹å®ç°ä¸åŒçš„é¿è®©è¡Œä¸ºã€‚

### NavMesh Obstacle æ¦‚è¦

#### ä¸¤ç§ä¸»è¦æ¨¡å¼

<details>
<summary><strong>é˜»æŒ¡æ¨¡å¼ (Obstructing)</strong></summary>

- **è¡Œä¸º**ï¼šå½“æœªå¯ç”¨ `Carve` æ—¶ï¼Œéšœç¢ç‰©è¡Œä¸ºä¸æ™®é€š `Collider` ç›¸ä¼¼ã€‚
- **æ•ˆæœ**ï¼š`NavMesh Agent` ä¼šè¿›è¡ŒåŸºç¡€é¿éšœï¼Œä½†èŒƒå›´æœ‰é™ï¼Œåœ¨å¯†é›†åœºæ™¯ä¸­å®¹æ˜“è¢«å µå¡ã€‚
</details>

<details>
<summary><strong>é›•åˆ»æ¨¡å¼ (Carving)</strong></summary>

- **è¡Œä¸º**ï¼šå¯ç”¨ `Carve` ä¸”éšœç¢ç‰©é™æ­¢æ—¶ï¼Œä¼šåœ¨ `NavMesh` ä¸Šåˆ‡å‡ºâ€œæ´â€ã€‚
- **æ•ˆæœ**ï¼šç§»åŠ¨æ—¶æ¢å¤ä¸ºé˜»æŒ¡æ¨¡å¼ï¼Œæœ‰åŠ©äº `Agent` åœ¨éšœç¢ç‰©å¯†é›†æˆ–è·¯å¾„è¢«é˜»å¡æ—¶é‡æ–°è§„åˆ’è·¯å¾„ã€‚
</details>

#### ç§»åŠ¨éšœç¢ç‰©çš„æ›´æ–°é€»è¾‘

Unity å°†éšœç¢ç‰©ç§»åŠ¨è¶…è¿‡ `Carve > Move Threshold` è®¾ç½®çš„è·ç¦»è§†ä¸ºâ€œç§»åŠ¨â€ï¼Œå¹¶åœ¨ä¸‹ä¸€å¸§é‡æ–°è®¡ç®—é›•åˆ»æ´ã€‚ä¸ºé™ä½ CPU å¼€é”€ï¼Œä»…åœ¨å¿…è¦æ—¶æ›´æ–°ï¼Œä¸”æœ‰ä¸€å¸§å»¶è¿Ÿæ‰ç”Ÿæ•ˆã€‚

### é‡è®¡ç®—æ¨¡å¼

#### ä»…é™æ­¢æ—¶é›•åˆ» (Carve Only Stationary)

- **çŠ¶æ€**ï¼šé»˜è®¤å¼€å¯ã€‚
- **è¿‡ç¨‹**ï¼š
  1. éšœç¢ç‰©ç§»åŠ¨æ—¶ç§»é™¤é›•åˆ»çš„â€œæ´â€ã€‚
  2. é™æ­¢å¹¶æŒç»­è¶…è¿‡ `Carving Time To Stationary` åå†é‡æ–°é›•åˆ»ã€‚
- **ç‰¹ç‚¹**ï¼šç§»åŠ¨ä¸­ä»…åšç¢°æ’è§„é¿ï¼Œä¸é‡æ–°è§„åˆ’è·¯å¾„ã€‚

##### ç§»åŠ¨ä¹Ÿé›•åˆ» (Carve when moved)

- **è®¾ç½®**ï¼šå–æ¶ˆå‹¾é€‰ `Carve Only Stationary`ã€‚
- **è¿‡ç¨‹**ï¼šæ¯å½“ç§»åŠ¨è¶…è¿‡ `Carving Move Threshold` æ—¶ï¼Œå®æ—¶æ›´æ–°é›•åˆ»æ´ã€‚
- **é€‚ç”¨åœºæ™¯**ï¼šä½“ç§¯å¤§ã€ç§»åŠ¨ç¼“æ…¢çš„éšœç¢ç‰©ï¼ˆå¦‚å¦å…‹ï¼‰ã€‚

#### **æ¨èè®¾ç½®**

- âœ… **Carve Only Stationary (ä»…é™æ­¢æ—¶é›•åˆ»)**ï¼šæ¨èä½¿ç”¨çš„é»˜è®¤æ¨¡å¼ï¼Œæ€§èƒ½æœ€ä½³ï¼Œå°¤å…¶é€‚åˆç”±ç‰©ç†ç³»ç»Ÿé©±åŠ¨çš„ `GameObject`ã€‚
- â˜‘ï¸ **Carve when moved (ç§»åŠ¨ä¹Ÿé›•åˆ»)**ï¼šå½“éšœç¢ç‰©ä½“ç§¯è¾ƒå¤§ä¸”ç§»åŠ¨ç¼“æ…¢ï¼Œéœ€è¦è®©è·¯å¾„åŠæ—¶è°ƒæ•´æ—¶ï¼Œå¯é€‰æ‹©æ­¤æ¨¡å¼ã€‚


::: tip
ä¿®æ”¹ `NavMesh Obstacle` çš„è®¾ç½®åï¼Œåˆ°å®é™…ç”Ÿæ•ˆå­˜åœ¨**ä¸€å¸§å»¶è¿Ÿ**ï¼Œä½¿ç”¨ `NavMesh` æŸ¥è¯¢æ–¹æ³•æ—¶éœ€æå‰è€ƒè™‘è¯¥å»¶è¿Ÿã€‚
:::

### Navigation Areas and Costs æ¦‚è¦
#### è·¯å¾„æˆæœ¬ (Pathfinding Cost)

- **å®šä¹‰**ï¼šåŒºåŸŸæˆæœ¬å†³å®šäº† A* ç®—æ³•åœ¨å¤šæ¡å¯è¡Œè·¯å¾„é—´çš„åå¥½ã€‚é«˜æˆæœ¬åŒºåŸŸç›¸å½“äºâ€œåŠ é•¿â€äº†è¯¥æ®µè·ç¦»ã€‚
- **è®¡ç®—æ–¹å¼**ï¼š`cost = è·ç¦» Ã— åŒºåŸŸæˆæœ¬`ã€‚æ‰€æœ‰æˆæœ¬å¿…é¡» `â‰¥ 1.0`ã€‚
- **è°ƒä¼˜å»ºè®®**ï¼š
  - å°†å¸¸ç”¨ä½†ä¸å¸Œæœ›é¢‘ç¹èµ°è¿‡çš„åŒºåŸŸï¼ˆå¦‚ `NavMesh Link`ï¼‰æˆæœ¬è°ƒé«˜ã€‚
  - æ³¨æ„ï¼šæˆæœ¬åªæ˜¯â€œæç¤ºâ€ï¼Œåœ¨è¾ƒé•¿è·¯å¾„ä¸Šæ•ˆæœéš¾ä»¥ç²¾ç¡®æ§åˆ¶ã€‚

### åŒºåŸŸç±»å‹ (Area Types)

| ç±»å‹ | è¯´æ˜ |
| :--- | :--- |
| **Walkable** | é»˜è®¤å¯è¡Œèµ°åŒºåŸŸã€‚ |
| **Not Walkable** | ç¦æ­¢ç”Ÿæˆ `NavMesh`ï¼Œç”¨äºå±è”½ç‰¹å®šç‰©ä½“æˆ–åŒºåŸŸã€‚ |
| **Jump** | è‡ªåŠ¨åˆ†é…ç»™ç”Ÿæˆçš„ `NavMesh Link`ï¼Œç”¨äºè·³è·ƒè¿æ¥ã€‚ |
| **è‡ªå®šä¹‰ç±»å‹** | æœ€å¤š 29 ç§ï¼Œå¯åœ¨ `Navigation` çª—å£çš„ â€œAreasâ€ é€‰é¡¹å¡ä¸‹æ–°å¢å’Œé…ç½®ã€‚ |

- **åŒºåŸŸå åŠ è§„åˆ™**ï¼šå½“åŒºåŸŸé‡å æ—¶ï¼Œé‡‡ç”¨ç´¢å¼•æœ€é«˜çš„ç±»å‹ã€‚`Not Walkable` å§‹ç»ˆä¼˜å…ˆï¼Œä»¥ä¾¿å¿«é€Ÿå°é—­åŒºåŸŸã€‚

#### åŒºåŸŸæ©ç  (Area Mask)

- **åŠŸèƒ½**ï¼šæ¯ä¸ª `NavMesh Agent` éƒ½æ‹¥æœ‰ä¸€ä¸ª `Area Mask`ï¼Œç”¨äºå¼€å¯æˆ–å±è”½å¯¹å„ç±»åŒºåŸŸçš„é€šè¡Œæƒé™ã€‚
- **è®¾ç½®æ–¹å¼**ï¼š
  - åœ¨ Inspector é¢æ¿ä¸­å‹¾é€‰ã€‚
  - é€šè¿‡è„šæœ¬åŠ¨æ€ä¿®æ”¹ã€‚
- **åº”ç”¨ç¤ºä¾‹**ï¼šå®ç°å·®å¼‚åŒ–è§’è‰²è¡Œä¸ºï¼Œä¾‹å¦‚åƒµå°¸æ— æ³•é€šè¿‡é—¨ï¼ˆ`Door` åŒºåŸŸï¼‰ï¼Œä½†äººç±»å¯ä»¥è‡ªç”±å‡ºå…¥ã€‚

## Navigation Overview

### åˆ›å»º `NavMesh`

åˆ›å»º `NavMesh` ç”¨äºå®šä¹‰åœºæ™¯ä¸­çš„å¯å¯¼èˆªåŒºåŸŸï¼Œä½¿è§’è‰²èƒ½å¤Ÿåœ¨è¯¥åŒºåŸŸå†…æ™ºèƒ½å¯¼èˆªã€‚

#### ğŸ“‹ åˆ›å»ºæ­¥éª¤

1. **é€‰æ‹©å‡ ä½•ä½“**
   - é€‰æ‹©è¦æ·»åŠ  `NavMesh` çš„åœºæ™¯å‡ ä½•ä½“

2. **æ·»åŠ ç»„ä»¶**
   - åœ¨ `Inspector` çª—å£ä¸­ï¼Œç‚¹å‡» **"Add Component"**
   - é€‰æ‹© `Navigation` > `NavMesh Surface`

3. **é…ç½®è®¾ç½®**
   - åœ¨ `NavMesh Surface` ç»„ä»¶ä¸­ï¼ŒæŒ‡å®šå¿…è¦çš„è®¾ç½®
   - ğŸ“– æœ‰å…³å¯ç”¨è®¾ç½®çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… [NavMesh Surface ç»„ä»¶](https://docs.unity3d.com/Packages/com.unity.ai.navigation@2.0/manual/NavMeshSurface.html)

4. **çƒ˜ç„™ NavMesh**
   - å®Œæˆé…ç½®åï¼Œç‚¹å‡» **"Bake"** æŒ‰é’®

#### ğŸ¨ å¯è§†åŒ–æ•ˆæœ

çƒ˜ç„™å®Œæˆåï¼Œ`NavMesh` ä¼šç”Ÿæˆå¹¶æ˜¾ç¤ºåœ¨åœºæ™¯ä¸­ï¼š

::: tip
åªè¦ `Navigation` çª—å£æ‰“å¼€å¹¶å¯è§ï¼ŒNavMesh å°±ä»¥**è“è‰²è¦†ç›–å±‚**çš„å½¢å¼æ˜¾ç¤ºåœ¨åŸºç¡€åœºæ™¯å‡ ä½•ä½“ä¸Šã€‚
:::

#### ğŸ”„ æ›´æ–° NavMesh

å½“ä»¥ä¸‹æƒ…å†µå‘ç”Ÿæ—¶ï¼Œå¯ä»¥å†æ¬¡çƒ˜ç„™ï¼ˆBakeï¼‰`NavMesh` æ¥æ›´æ–°ï¼š

- âœ… åœºæ™¯å‡ ä½•ä½“å‘ç”Ÿæ›´æ”¹
- âœ… `NavMesh` ä¿®é¥°ç¬¦å±æ€§æ”¹å˜
- âœ… `NavMesh Surface` ç»„ä»¶å±æ€§ä¿®æ”¹
- âœ… æ‰€é€‰ Agent ç±»å‹è®¾ç½®å˜æ›´

#### ğŸ—‘ï¸ ç§»é™¤ NavMesh

è¦æ°¸ä¹…ä»é¡¹ç›®ä¸­ç§»é™¤ `NavMesh`ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»»æ„ä¸€ç§æ–¹å¼ï¼š

| æ–¹æ³• | æ“ä½œæ­¥éª¤ | æ•ˆæœ |
|------|----------|------|
| **ç»„ä»¶é¢æ¿** | åœ¨ `NavMesh Surface` Inspector ä¸­ï¼Œç‚¹å‡» **"Clear"** æŒ‰é’® | æ¸…é™¤å½“å‰ `NavMesh` |
| **é¡¹ç›®çª—å£** | åœ¨ `Project` çª—å£ä¸­åˆ é™¤ `NavMesh` èµ„æºæ–‡ä»¶ | å®Œå…¨åˆ é™¤èµ„æº |

::: warning
âš ï¸ **æ³¨æ„**ï¼šå¦‚æœä»…ä» GameObject ä¸Šç§»é™¤ `NavMesh Surface` ç»„ä»¶ï¼Œ`NavMesh` èµ„æºæ–‡ä»¶å¹¶ä¸ä¼šè¢«åˆ é™¤ï¼Œå³ä½¿ `NavMesh` ä¸å†å‡ºç°åœ¨åœºæ™¯ä¸­ã€‚
:::

### åˆ›å»º NavMesh Agent

ä¸€æ—¦ä½ çš„å…³å¡å·²ç»çƒ˜ç„™ï¼ˆBakeï¼‰äº† `NavMesh`ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯ä»¥åœ¨åœºæ™¯ä¸­æ™ºèƒ½å¯¼èˆªçš„è§’è‰²ã€‚æˆ‘ä»¬å°†ç”¨ä¸€ä¸ªåœ†æŸ±ä½“æ¥æ­å»ºåŸå‹ä»£ç†ï¼Œå¹¶é€šè¿‡ `NavMesh Agent` ç»„ä»¶å’Œä¸€ä¸ªç®€å•è„šæœ¬æ¥æ§åˆ¶å®ƒçš„ç§»åŠ¨ã€‚

#### ğŸ¯ åˆ›å»ºè§’è‰²

| æ­¥éª¤ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| **1. åˆ›å»ºå‡ ä½•ä½“** | `GameObject` > `3D Object` > `Cylinder` | åœ¨å±‚çº§é¢æ¿ä¸­åˆ›å»ºåœ†æŸ±ä½“ |
| **2. é»˜è®¤å°ºå¯¸** | é«˜åº¦ `2`ï¼ŒåŠå¾„ `0.5` | é€‚åˆä½œä¸ºç±»äººå½¢è§’è‰²ï¼Œæ— éœ€è°ƒæ•´ |
| **3. æ·»åŠ ç»„ä»¶** | `Add Component` > `Navigation` > `NavMesh Agent` | åœ¨æ£€è§†é¢æ¿ä¸­æ·»åŠ å¯¼èˆªç»„ä»¶ |

::: tip
âœ… **å®Œæˆæ ‡å¿—**ï¼šæ­¤æ—¶ï¼Œä½ å·²ç»æ‹¥æœ‰äº†ä¸€ä¸ªå¯ä»¥æ¥æ”¶å¯¼èˆªå‘½ä»¤çš„åŸºç¡€ `NavMesh Agent`ã€‚
:::

![NavMesh Agent](images/NavMesh%20Agent.png)



#### ğŸ® è„šæœ¬æ§åˆ¶å¯¼èˆª

`NavMesh Agent` ç»„ä»¶è´Ÿè´£è§’è‰²çš„å¯»è·¯å’Œç§»åŠ¨æ§åˆ¶ã€‚åœ¨è„šæœ¬ä¸­ï¼Œå¯¼èˆªæµç¨‹é€šå¸¸åªéœ€è®¾ç½®ç›®æ ‡ä½ç½®ï¼Œå…¶ä½™ç”± `Agent` è‡ªåŠ¨å®Œæˆã€‚

```csharp [MoveTo.cs]
using UnityEngine;
using UnityEngine.AI;

public class MoveTo : MonoBehaviour
{
    [Header("å¯¼èˆªè®¾ç½®")]
    public Transform goal;

    void Start()
    {
        NavMeshAgent agent = GetComponent<NavMeshAgent>();
        agent.destination = goal.position;
    }
}
```

ä»¥ä¸Šè„šæœ¬ä¼šåœ¨æ¸¸æˆå¼€å§‹æ—¶ï¼Œå°† `Agent` çš„ç›®æ ‡è®¾ç½®ä¸ºæŒ‡å®š `Transform`ã€‚

#### âš™ï¸ é…ç½®åœºæ™¯ç›®æ ‡

æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®Œæˆåœºæ™¯é…ç½®ï¼š

##### ğŸ“ æ­¥éª¤ 1ï¼šè„šæœ¬é…ç½®
1. **åˆ›å»ºè„šæœ¬**ï¼šåˆ›å»ºå¹¶ç¼–è¾‘ `MoveTo.cs` è„šæœ¬
2. **æ›¿æ¢å†…å®¹**ï¼šå°†å†…å®¹æ›¿æ¢ä¸ºä¸Šæ–‡ç¤ºä¾‹ä»£ç 
3. **æ·»åŠ åˆ°è§’è‰²**ï¼šå°† `MoveTo` è„šæœ¬æ‹–æ‹½åˆ°åœºæ™¯ä¸­çš„åœ†æŸ±ä½“è§’è‰²ä¸Š

##### ğŸ¯ æ­¥éª¤ 2ï¼šç›®æ ‡è®¾ç½®
1. **åˆ›å»ºç›®æ ‡**ï¼šåœ¨å±‚çº§é¢æ¿ä¸­åˆ›å»ºçƒä½“ï¼ˆ`GameObject` > `3D Object` > `Sphere`ï¼‰
2. **å®šä½ç›®æ ‡**ï¼šå°†çƒä½“ç§»è‡³é è¿‘ `NavMesh` è¡¨é¢ä¸”ä¸è§’è‰²æœ‰ä¸€å®šè·ç¦»çš„ä½ç½®
3. **å…³è”ç›®æ ‡**ï¼šé€‰ä¸­è§’è‰²ï¼Œåœ¨ `MoveTo` è„šæœ¬çš„ `Goal` å±æ€§ä¸­ï¼Œæ‹–å…¥è¯¥çƒä½“

##### â–¶ï¸ æ­¥éª¤ 3ï¼šæµ‹è¯•è¿è¡Œ
ç‚¹å‡»æ’­æ”¾æŒ‰é’®ï¼ˆ**Play**ï¼‰ï¼Œå³å¯çœ‹åˆ°è§’è‰²è‡ªåŠ¨æ²¿ `NavMesh` å¯¼èˆªè‡³çƒä½“ä½ç½®ã€‚

#### ğŸ“Œ æ ¸å¿ƒè¦ç‚¹

**ç®€åŒ–å¯¼èˆª**ï¼šåœ¨è„šæœ¬ä¸­è·å– `NavMesh Agent` å¼•ç”¨åï¼Œåªéœ€å°† `agent.destination` è®¾ç½®ä¸ºç›®æ ‡åæ ‡ï¼Œå³å¯è§¦å‘è‡ªåŠ¨å¯»è·¯å’Œç§»åŠ¨ã€‚

| ç»„ä»¶èŒè´£ | æè¿° |
|----------|------|
| **NavMesh Agent** | è´Ÿè´£è·¯å¾„è®¡ç®—ã€ç¢°æ’æ£€æµ‹ã€ç§»åŠ¨æ§åˆ¶ |
| **MoveTo è„šæœ¬** | è®¾ç½®ç›®æ ‡ä½ç½®ï¼Œè§¦å‘å¯¼èˆªè¡Œä¸º |
| **ç›®æ ‡ Transform** | æä¾›å¯¼èˆªç»ˆç‚¹åæ ‡ |

### åˆ›å»º NavMesh Obstacle

`NavMesh Obstacle` ç»„ä»¶ç”¨äºå®šä¹‰åœ¨å¯¼èˆªæ—¶ä»£ç†åº”é¿å¼€çš„éšœç¢ç‰©ã€‚ä¾‹å¦‚ï¼Œä»£ç†åœ¨ç§»åŠ¨æ—¶ä¼šé¿å¼€ç”±ç‰©ç†ç³»ç»Ÿæ§åˆ¶çš„ç‰©ä½“ï¼Œå¦‚æ¿æ¡ç®±å’Œæ²¹æ¡¶ã€‚

#### ç¤ºä¾‹ï¼šæ·»åŠ ä¸€ä¸ªæ¿æ¡ç®±éšœç¢ç‰©

1.  **åˆ›å»ºç«‹æ–¹ä½“**
    *   åœ¨å±‚çº§è§†å›¾ä¸­ï¼Œä¾æ¬¡é€‰æ‹© `GameObject` > `3D Object` > `Cube`ï¼Œåˆ›å»ºä¸€ä¸ªç«‹æ–¹ä½“æ¥è¡¨ç¤ºæ¿æ¡ç®±ã€‚
    *   å°†ç«‹æ–¹ä½“ç§»åŠ¨åˆ°å…³å¡é¡¶éƒ¨çš„å¹³å°ä¸Šï¼Œä½¿ç”¨é»˜è®¤å°ºå¯¸å³å¯ã€‚

2.  **æ·»åŠ  `NavMesh Obstacle` ç»„ä»¶**
    *   åœ¨æ£€è§†é¢æ¿ä¸­ç‚¹å‡» `Add Component`ï¼Œé€‰æ‹© `Navigation` > `NavMesh Obstacle`ï¼Œä¸ºç«‹æ–¹ä½“æ·»åŠ  `NavMesh Obstacle` ç»„ä»¶ã€‚
    *   å°† `Shape`ï¼ˆå½¢çŠ¶ï¼‰è®¾ç½®ä¸º `Box`ï¼Œæ­¤æ—¶ä¸­å¿ƒå’Œå°ºå¯¸ä¼šè‡ªåŠ¨åŒ¹é…æ¸²æŸ“ç½‘æ ¼ã€‚

3.  **æ·»åŠ  `Rigid Body` ç»„ä»¶**ï¼ˆéå¿…è¦ï¼‰
    *   å†æ¬¡ç‚¹å‡» `Add Component`ï¼Œé€‰æ‹© `Physics` > `Rigid Body`ï¼Œä¸ºéšœç¢ç‰©æ·»åŠ åˆšä½“ç»„ä»¶ã€‚
  
4.  **å¯ç”¨ `Carve` å±æ€§**
    *   åœ¨ `NavMesh Obstacle` çš„æ£€è§†é¢æ¿ä¸­å¯ç”¨ `Carve`ï¼Œè®©ä»£ç†çŸ¥é“è¦ç»•å¼€æ­¤éšœç¢ç‰©ã€‚

è¿™æ ·ï¼Œä½ å°±åˆ›å»ºäº†ä¸€ä¸ªå—ç‰©ç†æ§åˆ¶çš„å¯ç§»åŠ¨æ¿æ¡ç®±ï¼ŒAI åœ¨å¯¼èˆªæ—¶ä¼šè‡ªåŠ¨é¿è®©å®ƒã€‚

::: info
å½“ä½ çš„éšœç¢ç‰©ä¸éœ€è¦è¿›è¡ŒçœŸå®çš„ç‰©ç†äº¤äº’æ—¶ï¼Œå®Œå…¨ä¸éœ€è¦æ·»åŠ  `Rigid Body` ç»„ä»¶ã€‚
:::

#### `Carve` é€‰é¡¹

`Carve` é€‰é¡¹æ˜¯å¦å‹¾é€‰ï¼Œå–å†³äºä½ æƒ³è¦è¾¾æˆçš„è¡Œä¸ºæ•ˆæœå’Œå¯¹æ€§èƒ½çš„è€ƒè™‘ã€‚



| ç‰¹æ€§ (Feature) | å‹¾é€‰ `Carve` (é›•åˆ»æ¨¡å¼) | ä¸å‹¾é€‰ `Carve` (é¿è®©æ¨¡å¼) |
| :--- | :--- | :--- |
| **å·¥ä½œåŸç†** | åœ¨ NavMesh ä¸ŠåŠ¨æ€â€œæŒ–æ´â€ï¼Œæ”¹å˜ç½‘æ ¼ç»“æ„ | NavMesh ä¿æŒä¸å˜ï¼Œç”± Agent ä¸»åŠ¨è¿›è¡Œå±€éƒ¨é¿è®© |
| **è¡Œä¸ºæ•ˆæœ** | å®è§‚è·¯å¾„é‡æ–°è®¡ç®—ï¼Œåƒé‡åˆ°ä¸€å µæ–°å¢™ | å±€éƒ¨ç§»åŠ¨è·¯å¾„è°ƒæ•´ï¼Œåƒèº²é¿ä¸€ä¸ªè¡Œäºº |
| **æ€§èƒ½å¼€é”€** | **é«˜** (ä¿®æ”¹ NavMesh æ˜¯æ˜‚è´µæ“ä½œ) | **ä½** (é¿è®©ç®—æ³•éå¸¸é«˜æ•ˆ) |
| **å¯é æ€§** | **é«˜** (100% é˜»æŒ¡) | **ä¸­ç­‰** (æç«¯æƒ…å†µå¯èƒ½å¤±è´¥æˆ–ç©¿é€) |
| **æ ¸å¿ƒåŒºåˆ«** | **ç¡¬æ€§é˜»æŒ¡** (Hard Block) | **æŸ”æ€§é¿è®©** (Soft Avoidance) |
| **é€‚ç”¨åœºæ™¯** | è‡ªåŠ¨é—¨ã€åŠæ¡¥ã€å‡é™å¢™ç­‰**å°‘é‡**ã€**å¿…é¡»**é˜»æ–­è·¯å¾„çš„ç‰©ä½“ | å…¶ä»– AI è§’è‰²ã€ç©å®¶ã€**å¤§é‡**çš„åŠ¨æ€å°ç‰©ä½“ |

### åˆ›å»º NavMesh Link

`NavMesh Link` ç”¨äºä¸ºå¯»è·¯ä»£ç†åœ¨å¯è¡Œèµ°å¯¼èˆªç½‘æ ¼ä¹‹å¤–åˆ›å»ºé€šè·¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½® `NavMesh Link` è®©ä»£ç†è·³è¿‡æ²Ÿæ¸ æˆ–ç¯±ç¬†ï¼Œæˆ–åœ¨ç©¿è¿‡å‰æ‰“å¼€ä¸€æ‰‡é—¨ã€‚

#### æ·»åŠ å’Œé…ç½® `NavMesh Link`

1.  **åˆ›å»ºåœ†æŸ±ä½“**
    *   åœ¨åœºæ™¯ä¸­åˆ›å»ºä¸¤ä¸ªåœ†æŸ±ä½“ï¼ˆèœå•ï¼šGameObject > 3D Object > Cylinderï¼‰ã€‚
    *   å°†åœ†æŸ±ä½“ç¼©æ”¾è‡³ `(0.1, 0.05, 0.1)`ï¼Œä»¥ä¾¿äºæ“ä½œã€‚
    *   å°†ç¬¬ä¸€ä¸ªåœ†æŸ±ä½“ç§»åŠ¨åˆ°ä¸Šå±‚å¹³å°çš„è¾¹ç¼˜ï¼Œé è¿‘å·²æœ‰çš„ `NavMesh` è¡¨é¢ã€‚
    *   å°†ç¬¬äºŒä¸ªåœ†æŸ±ä½“æ”¾ç½®åœ¨åœ°é¢ä¸Šï¼Œé è¿‘ `NavMesh`ï¼Œå¹¶å¯¹å‡†ä»£ç†é™è½çš„ä½ç½®ã€‚

2.  **æ·»åŠ  `NavMesh Link` ç»„ä»¶**
    *   é€‰ä¸­ç¬¬ä¸€ä¸ªåœ†æŸ±ä½“ï¼Œåœ¨ Inspector é¢æ¿ä¸­ç‚¹å‡» Add Component > Navigation > NavMesh Linkï¼Œä¸ºå…¶æ·»åŠ  `NavMesh Link` ç»„ä»¶ã€‚
    *   åœ¨ `Start Transform` å­—æ®µä¸­ï¼Œå°†ç¬¬ä¸€ä¸ªåœ†æŸ±ä½“æ‹–å…¥ï¼›åœ¨ `End Transform` å­—æ®µä¸­ï¼Œå°†ç¬¬äºŒä¸ªåœ†æŸ±ä½“æ‹–å…¥ã€‚

    æ­¤æ—¶ï¼Œä½ å·²æˆåŠŸè®¾ç½®äº†ä¸€ä¸ªå¯ç”¨çš„ `NavMesh Link`ã€‚ å½“é€šè¿‡æ­¤ `Link` çš„è·¯å¾„æ¯”æ²¿åŸæœ‰ `NavMesh` è¡Œèµ°æ›´çŸ­æ—¶ï¼Œå¯»è·¯ç³»ç»Ÿä¼šä¼˜å…ˆé€‰æ‹©ç»è¿‡è¯¥é“¾æ¥çš„è·¯å¾„ã€‚

    ä½ å¯ä»¥å°† `NavMesh Link` ç»„ä»¶é™„åŠ åˆ°åœºæ™¯ä¸­çš„ä»»ä½• `GameObject`ï¼ˆä¾‹å¦‚ç¯±ç¬†é¢„åˆ¶ä½“ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•å…·æœ‰ `Transform` çš„ `GameObject` ä½œä¸ºèµ·ç‚¹æˆ–ç»ˆç‚¹æ ‡è®°ã€‚ è¦äº†è§£å¯è°ƒæ•´çš„æ‰€æœ‰å±æ€§ï¼Œè¯·å‚é˜… `NavMesh Link` ç»„ä»¶å‚è€ƒæ–‡æ¡£ã€‚

#### è‡ªåŠ¨ç”Ÿæˆè·³è·ƒå’Œä¸‹è½é“¾æ¥

åœ¨è¿›è¡Œ `NavMesh` çƒ˜ç„™æ—¶ï¼Œç³»ç»Ÿå¯ä»¥è‡ªåŠ¨æ£€æµ‹å¹¶åˆ›å»ºå¸¸è§çš„è·¨è¶Šè·³è·ƒï¼ˆjump-acrossï¼‰å’Œä¸‹è½ï¼ˆdrop-downï¼‰é“¾æ¥ã€‚ è¯¦ç»†è®¾ç½®è¯·æŸ¥çœ‹ `NavMesh Surface` ç»„ä»¶çš„ç›¸å…³å‚æ•°ã€‚

#### æ•…éšœæ’é™¤ï¼š`Link` æ— æ³•ä½¿ç”¨æ—¶

å¦‚æœä»£ç†æ— æ³•ç©¿è¶Š `NavMesh Link`ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

*   ç¡®ä¿ä¸¤ç«¯çš„ç«¯ç‚¹éƒ½æ­£ç¡®è¿æ¥åˆ°å¯¼èˆªç½‘æ ¼ã€‚
*   åœ¨ `AI Navigation` è¦†ç›–å±‚ä¸­å¯ç”¨ `Show NavMesh debug visualization`ï¼Œå¯æŸ¥çœ‹è¿æ¥çŠ¶æ€ã€‚
    *   å½“é“¾æ¥å®½åº¦ä¸º `0` æ—¶ï¼Œæ­£ç¡®è¿æ¥çš„ç«¯ç‚¹ä¼šåœ¨åœºæ™¯è§†å›¾ä¸­æ˜¾ç¤ºä¸€ä¸ªåœ†åœˆã€‚
    *   å¦‚æœé“¾æ¥æœ‰å®½åº¦ï¼Œæ­£ç¡®è¿æ¥çš„è¾¹ä¼šä»¥æ·±è‰²çº¿æ®µæ˜¾ç¤ºï¼›æœªè¿æ¥çš„è¾¹åˆ™ä»¥ç°è‰²çº¿æ®µæ˜¾ç¤ºã€‚
    *   è‹¥ä¸¤ç«¯å‡å·²è¿æ¥ï¼Œå®½é“¾æ¥ä¼šé¢å¤–æ˜¾ç¤ºä¸€ä¸ªé€æ˜çš„å®å¿ƒçŸ©å½¢ï¼Œå¡«å……é“¾æ¥è¾¹ç¼˜ä¹‹é—´çš„ç©ºé—´ã€‚
    *   é“¾æ¥ä¸¤ç«¯ä¹‹é—´è¿˜ä¼šæ˜¾ç¤ºä¸€æ¡å¸¦ç®­å¤´çš„å¼§çº¿ï¼š
        *   è‡³å°‘ä¸€ç«¯è¿æ¥æ—¶ï¼Œå¼§çº¿ä¸ºé»‘è‰²ï¼›
        *   ä¸¤ç«¯éƒ½æœªè¿æ¥æ—¶ï¼Œå¼§çº¿ä¸ºç°è‰²ã€‚
*   å¦‚æœ `Activated` å±æ€§è¢«ç¦ç”¨ï¼Œåˆ™ä»»ä½•ä»£ç†æˆ–è·¯å¾„å‡æ— æ³•ç©¿è¶Šè¯¥é“¾æ¥ï¼Œæ­¤æ—¶åœºæ™¯è§†å›¾ä¸­é“¾æ¥æ˜¾ç¤ºä¸ºçº¢è‰²ã€‚è¯·ç¡®ä¿åœ¨éœ€è¦é€šè¡Œæ—¶å¯ç”¨æ­¤å±æ€§ã€‚
*   å¦ä¸€å¸¸è§åŸå› æ˜¯ `NavMesh Agent` çš„ `Area Mask` æœªåŒ…å«è¯¥ `NavMesh Link` æ‰€ä½¿ç”¨çš„åŒºåŸŸç±»å‹ã€‚

### ä¸å…¶ä»–ç»„ä»¶é…åˆä½¿ç”¨

#### æ¦‚è§ˆ

å½“ä½ å¸Œæœ›å°† `NavMesh Agent`ã€`NavMesh Obstacle` å’Œ `NavMesh Link` ç­‰å¯¼èˆªç»„ä»¶ä¸å…¶ä»– Unity ç»„ä»¶ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæœ¬æŒ‡å—åˆ—å‡ºäº†åœ¨æ··åˆä½¿ç”¨è¿™äº›ç»„ä»¶æ—¶çš„æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µã€‚

#### `NavMesh Agent` ä¸ç‰©ç†ç³»ç»Ÿ

ä½ æ— éœ€ä¸º `NavMesh Agent` æ·»åŠ ç‰©ç†ç¢°æ’å™¨ä¹Ÿèƒ½è®©å®ƒä»¬äº’ç›¸é¿å¼€ã€‚å¯¼èˆªç³»ç»Ÿä¼šæ¨¡æ‹Ÿ `Agent` ä¸éšœç¢ç‰©åŠé™æ€ä¸–ç•Œçš„äº¤äº’ï¼Œè¯¥â€œé™æ€ä¸–ç•Œâ€å³å·²çƒ˜ç„™çš„ `NavMesh`ã€‚

å¦‚æœä½ å¸Œæœ› `NavMesh Agent` æ¨åŠ¨ç‰©ç†å¯¹è±¡æˆ–è§¦å‘ç‰©ç†è§¦å‘å™¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1.  ä¸ºä»£ç†æ·»åŠ  `Collider` ç»„ä»¶ã€‚
2.  ä¸ºä»£ç†æ·»åŠ  `Rigidbody` ç»„ä»¶ã€‚
3.  å¯ç”¨ä»£ç† `Rigidbody` çš„ `Is Kinematic` å±æ€§ â€”â€” è¿™ä¸€æ­¥éå¸¸é‡è¦ï¼Œ`Kinematic` æ„å‘³ç€åˆšä½“çš„è¿åŠ¨ç”±å…¶ä»–ç³»ç»Ÿæ§åˆ¶ï¼Œè€Œéç‰©ç†æ¨¡æ‹Ÿæœ¬èº«ã€‚

å¦‚æœ `NavMesh Agent` çš„ `Rigidbody` æœªå¯ç”¨ `Kinematic`ï¼Œåˆ™ä¼šå‡ºç°ç«äº‰æ¡ä»¶ï¼Œä»£ç†å’Œåˆšä½“å¯èƒ½ä¼šåŒæ—¶å°è¯•ç§»åŠ¨ `Agent`ï¼Œä»è€Œå¯¼è‡´éš¾ä»¥é¢„æµ‹çš„è¡Œä¸ºã€‚

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `NavMesh Agent` é©±åŠ¨ç©å®¶è§’è‰²è€Œä¸ä½¿ç”¨ç‰©ç†ç³»ç»Ÿï¼š

*   å°†ç©å®¶ `Agent` çš„ `avoidance priority` è®¾ç½®ä¸ºè¾ƒä½æ•°å€¼ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰ï¼Œä»¥ä¾¿ç©å®¶èƒ½ç©¿è¿‡äººç¾¤ã€‚
*   é€šè¿‡ä¿®æ”¹ `NavMeshAgent.velocity` æ¥ç§»åŠ¨ç©å®¶ï¼Œè¿™æ ·å…¶ä»– `Agent` èƒ½é¢„æµ‹ç©å®¶çš„è¿åŠ¨å¹¶è¿›è¡Œé¿è®©ã€‚

#### `NavMesh Agent` ä¸åŠ¨ç”»ç³»ç»Ÿ

åŒæ—¶ä½¿ç”¨ `NavMesh Agent` å’Œå¸¦æœ‰ `Root Motion` çš„ `Animator` å¯èƒ½ä¼šäº§ç”Ÿç«äº‰æ¡ä»¶ï¼Œå› ä¸ºä¸¤è€…éƒ½ä¼šå°è¯•åœ¨æ¯å¸§æ›´æ–°ä¸­ç§»åŠ¨ `Transform`ã€‚

è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œæ ¸å¿ƒåŸåˆ™æ˜¯ä¿¡æ¯æµåº”å•å‘ä¼ é€’ï¼šè¦ä¹ˆç”± `Agent` æ§åˆ¶è§’è‰²ç§»åŠ¨ï¼ŒåŠ¨ç”»è·Ÿéšå…¶è¿åŠ¨ï¼›è¦ä¹ˆç”±åŠ¨ç”»æ§åˆ¶è§’è‰²ç§»åŠ¨ï¼Œ`Agent` è´Ÿè´£è·¯å¾„æ¨¡æ‹Ÿã€‚å¦åˆ™ä¼šå½¢æˆéš¾ä»¥è°ƒè¯•çš„åé¦ˆå›è·¯ã€‚

##### åŠ¨ç”»è·Ÿéš `Agent`

ä½¿ç”¨ `NavMeshAgent.velocity` ä½œä¸º `Animator` çš„è¾“å…¥ï¼Œå¤§è‡´åŒ¹é… `Agent` çš„è¿åŠ¨é€Ÿåº¦ä¸åŠ¨ç”»ã€‚

*   å®ç°ç®€å•ä¸”é²æ£’ï¼Œä½†å½“åŠ¨ç”»æ— æ³•ç²¾ç¡®åŒ¹é…é€Ÿåº¦æ—¶ä¼šå‡ºç°è„šéƒ¨æ»‘åŠ¨ç°è±¡ã€‚

##### `Agent` è·ŸéšåŠ¨ç”»

1.  ç¦ç”¨ `NavMeshAgent.updatePosition` å’Œ `NavMeshAgent.updateRotation`ï¼Œå°†æ¨¡æ‹Ÿè¿‡ç¨‹ä¸æ¸¸æˆç‰©ä½“ä½ç½®è§£è€¦ã€‚
2.  åˆ©ç”¨æ¨¡æ‹Ÿç»“æœ `NavMeshAgent.nextPosition` ä¸åŠ¨ç”»æ ¹ä½ç½® `Animator.rootPosition` ä¹‹é—´çš„å·®å€¼æ¥é©±åŠ¨åŠ¨ç”»æ§åˆ¶ã€‚

æ›´å¤šç»†èŠ‚è¯·å‚è§â€œè€¦åˆåŠ¨ç”»ä¸å¯¼èˆªâ€ç« èŠ‚ã€‚

#### `NavMesh Agent` ä¸ `NavMesh Obstacle`

è¿™ä¸¤è€…å¹¶ä¸å…¼å®¹ï¼åŒæ—¶å¯ç”¨ä¼šå¯¼è‡´ `Agent` è‡ªæˆ‘é¿è®©ã€‚å½“å¼€å¯é›•åˆ»ï¼ˆ`Carving`ï¼‰åŠŸèƒ½æ—¶ï¼Œ`Agent` è¿˜ä¼šä¸æ–­å°è¯•é‡æ–°æ˜ å°„åˆ°é›•åˆ»æ´ç©´çš„è¾¹ç¼˜ï¼Œäº§ç”Ÿæ›´å¤šé”™è¯¯è¡Œä¸ºã€‚

è¯·ç¡®ä¿åœ¨ä»»ä½•æ—¶åˆ»åªæœ‰å…¶ä¸­ä¸€ä¸ªç»„ä»¶å¤„äºæ´»åŠ¨çŠ¶æ€ï¼š

*   åœ¨ `Agent` å·²â€œæ­»äº¡â€æ—¶ï¼Œå¯å…³é—­ `Agent` ç»„ä»¶å¹¶å¯ç”¨ `Obstacle`ï¼Œä»¥å¼ºåˆ¶å…¶ä»– `Agent` é¿è®©ã€‚
*   æˆ–è€…é€šè¿‡è®¾ç½®ä¼˜å…ˆçº§ï¼Œä½¿ç‰¹å®š `Agent` æ›´æ˜“è¢«å…¶ä»– `Agent` é¿è®©ã€‚

#### `NavMesh Obstacle` ä¸ç‰©ç†ç³»ç»Ÿ

å¦‚æœä½ å¸Œæœ›åŸºäºç‰©ç†çš„å¯¹è±¡å½±å“ `NavMesh Agent` çš„è¡Œä¸ºï¼Œè¯·ï¼š

1.  ä¸ºè¯¥å¯¹è±¡æ·»åŠ  `NavMesh Obstacle` ç»„ä»¶ï¼Œè®©é¿è®©ç³»ç»Ÿèƒ½å¤Ÿè¯†åˆ«å¹¶è€ƒè™‘è¯¥éšœç¢ç‰©ã€‚
2.  å¦‚æœè¯¥æ¸¸æˆå¯¹è±¡åŒæ—¶æ‹¥æœ‰ `Rigidbody` å’Œ `NavMesh Obstacle`ï¼Œ`Obstacle` ä¼šè‡ªåŠ¨ä» `Rigidbody` è·å–é€Ÿåº¦ä¿¡æ¯ï¼Œè®© `NavMesh Agent` èƒ½é¢„æµ‹å¹¶é¿è®©ç§»åŠ¨éšœç¢ã€‚

### æ„å»ºé«˜åº¦ç½‘æ ¼

åœ¨å¯¼èˆªè¿‡ç¨‹ä¸­ï¼Œ`NavMesh Agent` ä¼šè¢«é™åˆ¶åœ¨ `NavMesh` æ›²é¢ä¸Šè¡Œèµ°ã€‚ç”±äº `NavMesh` åªæ˜¯å¯è¡Œèµ°ç©ºé—´çš„è¿‘ä¼¼è¡¨ç¤ºï¼ŒæŸäº›ç»†èŠ‚ï¼ˆå¦‚æ¥¼æ¢¯ï¼‰åœ¨çƒ˜ç„™åä¼šè¢«ç®€åŒ–ä¸ºæ–œé¢ã€‚å¦‚æœä½ çš„æ¸¸æˆéœ€è¦è§’è‰²åœ¨å¤æ‚åœ°å½¢ä¸Šæ›´åŠ ç²¾ç¡®åœ°æ”¾ç½®ï¼Œå¯ä»¥ä¸º `NavMesh` æ·»åŠ  `HeightMesh`ï¼Œæˆ–åœ¨çƒ˜ç„™ `NavMesh` æ—¶ä¸€å¹¶æ„å»º `HeightMesh`ã€‚

::: tip
æ„å»º `HeightMesh` ä¼šå ç”¨é¢å¤–çš„å†…å­˜å’Œè¿è¡Œæ—¶è®¡ç®—æ—¶é—´ï¼Œå› æ­¤çƒ˜ç„™ `NavMesh` çš„æ—¶é—´ä¼šç›¸åº”å¢åŠ ã€‚
:::

#### åœ¨ç°æœ‰ `NavMesh` ä¸Šæ·»åŠ  `HeightMesh`

1.  åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€åœºæ™¯ã€‚
2.  é€‰ä¸­åŒ…å« `NavMesh` çš„åœºæ™¯å‡ ä½•ä½“æˆ– `GameObject`ã€‚
3.  å¦‚æœ‰å¿…è¦ï¼Œåœ¨ `Inspector` é¢æ¿ä¸­å±•å¼€ `NavMesh Surface` ç»„ä»¶ã€‚
4.  åœ¨ `NavMesh Surface` ç»„ä»¶çš„ `Advanced` åŒºåŸŸä¸­ï¼Œå‹¾é€‰ `Build Height Mesh`ã€‚
5.  å®Œæˆè®¾ç½®åï¼Œç‚¹å‡» `Bake`ã€‚

    æ­¤æ—¶ï¼Œ`NavMesh` ä¼šä»¥è“è‰²è¦†ç›–å±‚æ˜¾ç¤ºï¼Œ`HeightMesh` ä¼šä»¥ç²‰è‰²è¦†ç›–å±‚æ˜¾ç¤ºã€‚

#### åœ¨çƒ˜ç„™ `NavMesh` æ—¶æ„å»º `HeightMesh`

1.  æŒ‰ç…§ â€œåˆ›å»º `NavMesh`â€ çš„æ­¥éª¤å…ˆè®¾ç½®å¥½ `NavMesh Surface` ç»„ä»¶ã€‚
2.  åœ¨ `NavMesh Surface` ç»„ä»¶ä¸­ï¼Œå‹¾é€‰ `Build Height Mesh`ã€‚
3.  å®Œæˆåï¼Œç‚¹å‡» `Bake`ã€‚

çƒ˜ç„™å®Œæˆåï¼Œ`NavMesh` ä»¥è“è‰²è¦†ç›–å±‚æ˜¾ç¤ºï¼Œ`HeightMesh` ä»¥ç²‰è‰²è¦†ç›–å±‚æ˜¾ç¤ºã€‚

### Navigation How-Tos

è®© `NavMeshAgent` ç§»åŠ¨åˆ°ç›®çš„åœ°
::: details å¸¦æˆ‘æŸ¥çœ‹ä»£ç 
```csharp [MoveDestination.cs]
using UnityEngine;
using UnityEngine.AI;

public class MoveDestination : MonoBehaviour {

    public Transform goal;

    void Start () {
        NavMeshAgent agent = GetComponent<NavMeshAgent>();
        agent.destination = goal.position;
    }
}
```
:::

é€šè¿‡ç‚¹å‡»ç§»åŠ¨ä»£ç†
::: details å¸¦æˆ‘æŸ¥çœ‹ä»£ç 
```csharp [MoveToClickPoint.cs]
using UnityEngine;
using UnityEngine.AI;

public class MoveToClickPoint : MonoBehaviour {
    NavMeshAgent agent;

    void Start() {
        agent = GetComponent<NavMeshAgent>();
    }

    void Update() {
        if (Input.GetMouseButtonDown(0)) {
            RaycastHit hit;

            if (Physics.Raycast(Camera.main.ScreenPointToRay(Input.mousePosition), out hit, 100)) {
                agent.destination = hit.point;
            }
        }
    }
}
```
:::

è®© Agent è¿›è¡Œç®€å•çš„å·¡é€»

::: details å¸¦æˆ‘æŸ¥çœ‹ä»£ç 
```csharp [Patrol.cs]
using UnityEngine;
using UnityEngine.AI;
using System.Collections;


public class Patrol : MonoBehaviour {

    public Transform[] points;
    private int destPoint = 0;
    private NavMeshAgent agent;


    void Start () {
        agent = GetComponent<NavMeshAgent>();

        // Disabling auto-braking allows for continuous movement
        // between points (i.e. the agent doesn't slow down as it
        // approaches a destination point).
        agent.autoBraking = false;

        GotoNextPoint();
    }


    void GotoNextPoint() {
        // Returns if no points have been set up
        if (points.Length == 0)
            return;

        // Set the agent to go to the currently selected destination.
        agent.destination = points[destPoint].position;

        // Choose the next point in the array as the destination,
        // cycling to the start if necessary.
        destPoint = (destPoint + 1) % points.Length;
    }


    void Update () {
        // Choose the next destination point when the agent gets
        // close to the current one.
        if (!agent.pathPending && agent.remainingDistance < 0.5f)
            GotoNextPoint();
    }
}
```
::: 

åŠ¨ç”»ä¸å¯¼èˆªçš„ç»“åˆ

```csharp [LocomotionSimpleAgent.cs]
[RequireComponent (typeof (NavMeshAgent))]
[RequireComponent (typeof (Animator))]
public class LocomotionSimpleAgent : MonoBehaviour {
    Animator anim;
    NavMeshAgent agent;
    Vector2 smoothDeltaPosition = Vector2.zero;
    Vector2 velocity = Vector2.zero;

    void Start ()
    {
        anim = GetComponent<Animator> ();
        agent = GetComponent<NavMeshAgent> ();
        // ä¸è¦è‡ªåŠ¨æ›´æ–°ä½ç½®ï¼Œæ‰‹åŠ¨æ§åˆ¶
        agent.updatePosition = false;
    }

    void Update ()
    {
        Vector3 worldDeltaPosition = agent.nextPosition - transform.position;

        // å°† worldDeltaPosition æ˜ å°„åˆ°å±€éƒ¨ç©ºé—´
        float dx = Vector3.Dot (transform.right, worldDeltaPosition);
        float dy = Vector3.Dot (transform.forward, worldDeltaPosition);
        Vector2 deltaPosition = new Vector2 (dx, dy);

        // å¯¹ deltaMove è¿›è¡Œä½é€šæ»¤æ³¢ï¼Œå¹³æ»‘å¤„ç†
        float smooth = Mathf.Min(1.0f, Time.deltaTime/0.15f);
        smoothDeltaPosition = Vector2.Lerp (smoothDeltaPosition, deltaPosition, smooth);

        // å¦‚æœæ—¶é—´å‰è¿›ï¼Œåˆ™æ›´æ–°é€Ÿåº¦
        if (Time.deltaTime > 1e-5f)
            velocity = smoothDeltaPosition / Time.deltaTime;

        bool shouldMove = velocity.magnitude > 0.5f && agent.remainingDistance > agent.radius;

        // æ›´æ–°åŠ¨ç”»å‚æ•°
        anim.SetBool("move", shouldMove);
        anim.SetFloat ("velx", velocity.x);
        anim.SetFloat ("vely", velocity.y);

        GetComponent<LookAt>().lookAtTargetPosition = agent.steeringTarget + transform.forward;
    }

    void OnAnimatorMove ()
    {
        // å°†ä½ç½®æ›´æ–°ä¸ºä»£ç†çš„ä½ç½®
        transform.position = agent.nextPosition;
    }
}
```

å¦‚æœå¸Œæœ›è¿åŠ¨ä¸»å¯¼ç”±åŠ¨ç”»çš„æ ¹è¿åŠ¨ä¸»å¯¼ï¼Œå¯ä»¥åšä»¥ä¸‹æ›´æ”¹ï¼š

```csharp [LocomotionSimpleAgent.cs]
void OnAnimatorMove ()
{
    // åŸºäºåŠ¨ç”»çš„è¿åŠ¨æ›´æ–°ä½ç½®ï¼Œä½¿ç”¨å¯¼èˆªè¡¨é¢çš„é«˜åº¦
    Vector3 position = anim.rootPosition;
    position.y = agent.nextPosition.y;
    transform.position = position;
}
```

æŠŠè§’è‰²æ‹‰å‘ä»£ç†ï¼Œåœ¨ `Update()` çš„æœ«å°¾æ·»åŠ ï¼š
```csharp 
if (worldDeltaPosition.magnitude > agent.radius)
    transform.position = agent.nextPosition - 0.9f * worldDeltaPosition;
```

æˆ–è€…æŠŠä»£ç†æ‹‰å‘è§’è‰²ï¼š
```csharp
if (worldDeltaPosition.magnitude > agent.radius)
    agent.nextPosition = transform.position + 0.9f * worldDeltaPosition;
```

## Navigation Interface

### Navigation çª—å£

è¯¥çª—å£ç”¨äºé…ç½®åœºæ™¯ä¸­ä½¿ç”¨çš„ `NavMesh` ä»£ç†ç±»å‹å’ŒåŒºåŸŸç±»å‹ï¼Œæ˜¯æ„å»º AI è·¯å¾„ç³»ç»Ÿçš„æ ¸å¿ƒå·¥å…·ä¹‹ä¸€ã€‚

è®¿é—®æ–¹å¼ï¼šåœ¨ä¸»èœå•ä¸­ç‚¹å‡» Window > AI > Navigation